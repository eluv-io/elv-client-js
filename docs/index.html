<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    Home - Documentation
  </title>

  <script src="scripts/prettify/prettify.js"></script>
  <script src="scripts/prettify/lang-css.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/elv-jsdoc.css">
  <link type="text/css" rel="stylesheet" href="styles/elv-prettify-jsdoc.css">
</head>

<body>
  <div class="layout-container">
    <nav class="nav-container">
      <div class="header">
        <a href="index.html">
          <img class="logo" src="images/logo-dark.png" />
        </a>
        <div class="title">
          Eluvio Javascript Client
        </div>
      </div>
      <div class="nav-content">
        <h3>Classes</h3><ul><li id="ElvClient-nav"><a href="ElvClient.html" class="class-link">ElvClient</a><ul class='methods'><li data-type="method" id="ElvClient-FromConfiguration-nav"><a href="ElvClient.html#.FromConfiguration" class="method-link">FromConfiguration</a></li><li data-type="method" id="ElvClient-CallBitcodeMethod-nav"><a href="ElvClient.html#CallBitcodeMethod" class="method-link">CallBitcodeMethod</a></li><li data-type="method" id="ElvClient-CallContractMethod-nav"><a href="ElvClient.html#CallContractMethod" class="method-link">CallContractMethod</a></li><li data-type="method" id="ElvClient-CallContractMethodAndWait-nav"><a href="ElvClient.html#CallContractMethodAndWait" class="method-link">CallContractMethodAndWait</a></li><li data-type="method" id="ElvClient-ContentLibraries-nav"><a href="ElvClient.html#ContentLibraries" class="method-link">ContentLibraries</a></li><li data-type="method" id="ElvClient-ContentLibrary-nav"><a href="ElvClient.html#ContentLibrary" class="method-link">ContentLibrary</a></li><li data-type="method" id="ElvClient-ContentObject-nav"><a href="ElvClient.html#ContentObject" class="method-link">ContentObject</a></li><li data-type="method" id="ElvClient-ContentObjectContractEvents-nav"><a href="ElvClient.html#ContentObjectContractEvents" class="method-link">ContentObjectContractEvents</a></li><li data-type="method" id="ElvClient-ContentObjectMetadata-nav"><a href="ElvClient.html#ContentObjectMetadata" class="method-link">ContentObjectMetadata</a></li><li data-type="method" id="ElvClient-ContentObjects-nav"><a href="ElvClient.html#ContentObjects" class="method-link">ContentObjects</a></li><li data-type="method" id="ElvClient-ContentObjectVersions-nav"><a href="ElvClient.html#ContentObjectVersions" class="method-link">ContentObjectVersions</a></li><li data-type="method" id="ElvClient-ContentParts-nav"><a href="ElvClient.html#ContentParts" class="method-link">ContentParts</a></li><li data-type="method" id="ElvClient-ContentType-nav"><a href="ElvClient.html#ContentType" class="method-link">ContentType</a></li><li data-type="method" id="ElvClient-ContentTypes-nav"><a href="ElvClient.html#ContentTypes" class="method-link">ContentTypes</a></li><li data-type="method" id="ElvClient-ContractEvents-nav"><a href="ElvClient.html#ContractEvents" class="method-link">ContractEvents</a></li><li data-type="method" id="ElvClient-CreateContentLibrary-nav"><a href="ElvClient.html#CreateContentLibrary" class="method-link">CreateContentLibrary</a></li><li data-type="method" id="ElvClient-CreateContentObject-nav"><a href="ElvClient.html#CreateContentObject" class="method-link">CreateContentObject</a></li><li data-type="method" id="ElvClient-CreateContentSpace-nav"><a href="ElvClient.html#CreateContentSpace" class="method-link">CreateContentSpace</a></li><li data-type="method" id="ElvClient-CreateContentType-nav"><a href="ElvClient.html#CreateContentType" class="method-link">CreateContentType</a></li><li data-type="method" id="ElvClient-DeleteContentLibrary-nav"><a href="ElvClient.html#DeleteContentLibrary" class="method-link">DeleteContentLibrary</a></li><li data-type="method" id="ElvClient-DeleteContentObject-nav"><a href="ElvClient.html#DeleteContentObject" class="method-link">DeleteContentObject</a></li><li data-type="method" id="ElvClient-DeleteContentVersion-nav"><a href="ElvClient.html#DeleteContentVersion" class="method-link">DeleteContentVersion</a></li><li data-type="method" id="ElvClient-DeleteMetadata-nav"><a href="ElvClient.html#DeleteMetadata" class="method-link">DeleteMetadata</a></li><li data-type="method" id="ElvClient-DeletePart-nav"><a href="ElvClient.html#DeletePart" class="method-link">DeletePart</a></li><li data-type="method" id="ElvClient-DeployContract-nav"><a href="ElvClient.html#DeployContract" class="method-link">DeployContract</a></li><li data-type="method" id="ElvClient-DownloadAllParts-nav"><a href="ElvClient.html#DownloadAllParts" class="method-link">DownloadAllParts</a></li><li data-type="method" id="ElvClient-DownloadPart-nav"><a href="ElvClient.html#DownloadPart" class="method-link">DownloadPart</a></li><li data-type="method" id="ElvClient-EditContentObject-nav"><a href="ElvClient.html#EditContentObject" class="method-link">EditContentObject</a></li><li data-type="method" id="ElvClient-ExtractValueFromEvent-nav"><a href="ElvClient.html#ExtractValueFromEvent" class="method-link">ExtractValueFromEvent</a></li><li data-type="method" id="ElvClient-FabricUrl-nav"><a href="ElvClient.html#FabricUrl" class="method-link">FabricUrl</a></li><li data-type="method" id="ElvClient-FinalizeContentObject-nav"><a href="ElvClient.html#FinalizeContentObject" class="method-link">FinalizeContentObject</a></li><li data-type="method" id="ElvClient-FormatContractArguments-nav"><a href="ElvClient.html#FormatContractArguments" class="method-link">FormatContractArguments</a></li><li data-type="method" id="ElvClient-GenerateWallet-nav"><a href="ElvClient.html#GenerateWallet" class="method-link">GenerateWallet</a></li><li data-type="method" id="ElvClient-GetBalance-nav"><a href="ElvClient.html#GetBalance" class="method-link">GetBalance</a></li><li data-type="method" id="ElvClient-MergeMetadata-nav"><a href="ElvClient.html#MergeMetadata" class="method-link">MergeMetadata</a></li><li data-type="method" id="ElvClient-Proofs-nav"><a href="ElvClient.html#Proofs" class="method-link">Proofs</a></li><li data-type="method" id="ElvClient-PublicLibraryMetadata-nav"><a href="ElvClient.html#PublicLibraryMetadata" class="method-link">PublicLibraryMetadata</a></li><li data-type="method" id="ElvClient-QParts-nav"><a href="ElvClient.html#QParts" class="method-link">QParts</a></li><li data-type="method" id="ElvClient-Rep-nav"><a href="ElvClient.html#Rep" class="method-link">Rep</a></li><li data-type="method" id="ElvClient-ReplaceMetadata-nav"><a href="ElvClient.html#ReplaceMetadata" class="method-link">ReplaceMetadata</a></li><li data-type="method" id="ElvClient-ReplacePublicLibraryMetadata-nav"><a href="ElvClient.html#ReplacePublicLibraryMetadata" class="method-link">ReplacePublicLibraryMetadata</a></li><li data-type="method" id="ElvClient-SendFunds-nav"><a href="ElvClient.html#SendFunds" class="method-link">SendFunds</a></li><li data-type="method" id="ElvClient-SetContentLibraryImage-nav"><a href="ElvClient.html#SetContentLibraryImage" class="method-link">SetContentLibraryImage</a></li><li data-type="method" id="ElvClient-SetContentObjectImage-nav"><a href="ElvClient.html#SetContentObjectImage" class="method-link">SetContentObjectImage</a></li><li data-type="method" id="ElvClient-SetCustomContentContract-nav"><a href="ElvClient.html#SetCustomContentContract" class="method-link">SetCustomContentContract</a></li><li data-type="method" id="ElvClient-SetSigner-nav"><a href="ElvClient.html#SetSigner" class="method-link">SetSigner</a></li><li data-type="method" id="ElvClient-UploadPart-nav"><a href="ElvClient.html#UploadPart" class="method-link">UploadPart</a></li><li data-type="method" id="ElvClient-VerifyContentObject-nav"><a href="ElvClient.html#VerifyContentObject" class="method-link">VerifyContentObject</a></li></ul></li><li id="ElvWallet-nav"><a href="ElvWallet.html" class="class-link">ElvWallet</a><ul class='methods'><li data-type="method" id="ElvWallet-AddAccount-nav"><a href="ElvWallet.html#AddAccount" class="method-link">AddAccount</a></li><li data-type="method" id="ElvWallet-AddAccountFromEncryptedPK-nav"><a href="ElvWallet.html#AddAccountFromEncryptedPK" class="method-link">AddAccountFromEncryptedPK</a></li><li data-type="method" id="ElvWallet-AddAccountFromMnemonic-nav"><a href="ElvWallet.html#AddAccountFromMnemonic" class="method-link">AddAccountFromMnemonic</a></li><li data-type="method" id="ElvWallet-GenerateEncryptedPrivateKey-nav"><a href="ElvWallet.html#GenerateEncryptedPrivateKey" class="method-link">GenerateEncryptedPrivateKey</a></li><li data-type="method" id="ElvWallet-GenerateMnemonic-nav"><a href="ElvWallet.html#GenerateMnemonic" class="method-link">GenerateMnemonic</a></li><li data-type="method" id="ElvWallet-GetAccount-nav"><a href="ElvWallet.html#GetAccount" class="method-link">GetAccount</a></li><li data-type="method" id="ElvWallet-GetAccountBalance-nav"><a href="ElvWallet.html#GetAccountBalance" class="method-link">GetAccountBalance</a></li><li data-type="method" id="ElvWallet-RemoveAccount-nav"><a href="ElvWallet.html#RemoveAccount" class="method-link">RemoveAccount</a></li></ul></li><li id="FrameClient-nav"><a href="FrameClient.html" class="class-link">FrameClient</a><ul class='methods'><li data-type="method" id="FrameClient-AllowedMethods-nav"><a href="FrameClient.html#AllowedMethods" class="method-link">AllowedMethods</a></li></ul></li></ul><h3>Namespaces</h3><ul><li id="Utils-nav"><a href="Utils.html" class="class-link">Utils</a><ul class='methods'><li data-type="method" id="Utils-AddressToHash-nav"><a href="Utils.html#.AddressToHash" class="method-link">AddressToHash</a></li><li data-type="method" id="Utils-AddressToLibraryId-nav"><a href="Utils.html#.AddressToLibraryId" class="method-link">AddressToLibraryId</a></li><li data-type="method" id="Utils-AddressToObjectId-nav"><a href="Utils.html#.AddressToObjectId" class="method-link">AddressToObjectId</a></li><li data-type="method" id="Utils-AddressToSpaceId-nav"><a href="Utils.html#.AddressToSpaceId" class="method-link">AddressToSpaceId</a></li><li data-type="method" id="Utils-EqualHash-nav"><a href="Utils.html#.EqualHash" class="method-link">EqualHash</a></li><li data-type="method" id="Utils-HashToAddress-nav"><a href="Utils.html#.HashToAddress" class="method-link">HashToAddress</a></li><li data-type="method" id="Utils-IsCloneable-nav"><a href="Utils.html#.IsCloneable" class="method-link">IsCloneable</a></li><li data-type="method" id="Utils-MakeClonable-nav"><a href="Utils.html#.MakeClonable" class="method-link">MakeClonable</a></li><li data-type="method" id="Utils-ToBytes32-nav"><a href="Utils.html#.ToBytes32" class="method-link">ToBytes32</a></li></ul></li></ul>
      </div>
    </nav>

    <div class="main">
      <div class="header"></div>
      <div class="main-content">
        

        
      



    

      


  <section class="readme">
    <article>
      <h1>Eluvio JS Client</h1><h3>Installation</h3><h4>Install using NPM:</h4><p><code>npm install --save https://github.com/qluvio/elv-client-js</code></p>
<h5>Browser:</h5><p><code>const { ElvClient } = require(&quot;elv-client-js&quot;);</code></p>
<h5>Node:</h5><p><code>const { ElvClient } = require(&quot;elv-client-js/ElvClient-node-min.js&quot;);</code></p>
<h4>Install manually:</h4><h5>Browser:</h5><p>include <code>./ElvClient-min.js</code></p>
<h5>Node:</h5><p>include <code>./ElvClient-node-min.js</code></p>
<p>See: </p>
<ul>
<li><code>./test/TestMethods.js</code> for example usage of most functionality</li>
<li><code>./test/ExampleOutput.txt</code> for example output from these examples</li>
<li><code>./test/Test.html</code> for example usage in browser</li>
<li><code>./test/Test.js</code> for example usage in node</li>
</ul>
<h3>API Client</h3><p>See <code>./src/ElvClient.js</code> for all available endpoints.</p>
<h4>Initializing the client</h4><pre class="prettyprint source lang-javascript"><code>let client = new ElvClient({
  contentSpaceId: &quot;ispc6NxBDhWiRuKyDNMWVmpTuCaQssS2iuDfq8hFkivVoeJw&quot;,
  hostname: &quot;localhost&quot;,
  port: 8008,
  useHTTPS: false,
  ethHostname: &quot;localhost&quot;,
  port: 8545,
  useHTTPS: false
});</code></pre><p>From a configuration file:</p>
<pre class="prettyprint source lang-json"><code>// TestConfiguration.json:
{
  &quot;fabric&quot;: {
    &quot;contentSpaceId&quot;: &quot;ispc33dJvdsPi3Njj6D6VkDJus2HG9JD&quot;,
    &quot;hostname&quot;: &quot;localhost&quot;,
    &quot;port&quot;: 8008,
    &quot;use_https&quot;: false
  },
  &quot;ethereum&quot;: {
    &quot;hostname&quot;: &quot;localhost&quot;,
    &quot;port&quot;: 8545,
    &quot;use_https&quot;: false
  }
}</code></pre><pre class="prettyprint source lang-javascript"><code>const ClientConfiguration = require(&quot;TestConfiguration.json&quot;);
let client = ElvClient.FromConfiguration({configuration: ClientConfiguration});</code></pre><p>All method arguments are <strong>named hashes</strong> for clarity. </p>
<p>For example:</p>
<pre class="prettyprint source lang-javascript"><code>client.DownloadPart({
  libraryId: &quot;ilibWL9CAVcQYZPHB58SDRMkwQ&quot;, 
  contentHash: &quot;hq__QmdSKNUk4pabuUTAXo4F2dAkzkioeagy4r1fuAcBHL2k7X&quot;, 
  partHash: &quot;hqp_QmU3QKSgShnQQSnKdmEMDgo4AimNHg3JHy4SY7DymVy5WN&quot;,
  format: &quot;blob&quot;
})</code></pre><h4>Using the client:</h4><p>The API client will query the fabric endpoint and return the parsed JSON for JSON based endpoints.</p>
<p>For non-JSON endpoints, such as downloading a file, the format can be specified. By default, it will be parsed as a blob. See <code>ElvClient#ResponseToFormat</code> for available formats. If the specified format is explicitly undefined or otherwise does not match any formats, the raw <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a> will be returned.</p>
<p>All query methods are async methods that will return <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a>.</p>
<p>Examples:</p>
<pre class="prettyprint source lang-javascript"><code>// Using .then
let query = client.ContentLibraries();
query.then(contentLibraries => console.log(contentLibraries));


// Using async/await
let response = await client.ContentLibraries();
console.log(json);


/* Result:

[ 'ilib181m5UqiibeHCkvydb5zvs',
  'ilib2nhndXbwNsZpSW4vGKZtUL',
  'ilib6M65FWP5VURJAgg5UgH49F',
  'ilib7HDyiWuH2qecS8aAciv7n4',
  'ilibBSZ8isuvUfsejLwfHAqY5',
  'ilibCAB6N2uAokYSCsDdx4D1ho',
  'ilibEWFJtGT2J2qJ2U8one7rqL',
  'ilibGHb9b8yxAeG1ZgGF9GZNj8',
  'ilibGuftC7MRHF4HWwe7SpN9U3',
  'ilibHR9n78xEztxzZuCrr6zcAg',
  'ilibMKsosn5FoZNsY42S6JkbFm',
  'ilibMjtps7qHeaLtyZ5RL9msU2',
  'ilibQWUSXUaZdj4gUG3PU96F9U',
  'ilibS3AiQca535GpdN8wR1guTR',
  'ilibUJqT5tEgi8NtdFedaUxcQL',
  'ilibUZNhCvvaFF9c2m2o2pjfqN',
  'ilibWL9CAVcQYZPHB58SDRMkwQ' ]
 */</code></pre><p>Non-JSON data like files and parts will be returned as a blob by default, but other formats can be specified (as well as returning the raw <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a>)</p>
<pre class="prettyprint source lang-javascript"><code>// Using .then
let query = client.QParts({
  partHash: &quot;hqp_QmWuCKNpTeVp2mUP1sQwaJLVVTWvepxCqWks3Mrt2UZCRQ&quot;,
  format: &quot;arraybuffer&quot;
});

query.then(arrayBuffer => console.log(Buffer.from(arrayBuffer)));


// Using async/await
let response = await client.QParts({
  partHash: &quot;hqp_QmWuCKNpTeVp2mUP1sQwaJLVVTWvepxCqWks3Mrt2UZCRQ&quot;,
  format: &quot;arrayBuffer&quot;
});
console.log(buffer);


// Result
// &lt;Buffer 06 2f 63 62 6f 72 0a a2 67 51 6d 64 48 61 73 68 58 23 02 12 20 7f ee 10 b7 b4 9c 71 38 59 81 83 cc ed 06 d7 09 60 07 a7 0d ed 2d 55 56 0e 9c 7b 79 ca ... ></code></pre><h3>Blockchain Interaction</h3><h3>Authorization</h3><p>Being a decentralized, trustless ecosystem, the content fabric relies on smart contracts and blockchain transactions to verify that a user is allowed to perform an action. Each type of content (content spaces, libraries, objects, types) have associated smart contracts deployed to the blockchain that mediate access.</p>
<p>For example, to access a content object, the requestor must call the accessRequest method on that content object's smart contract, then pass the transaction hash in the authorization token when querying the content fabric API. The content fabric will then verify the transaction before performing the requested action. If the transaction is invalid, access will be denied.</p>
<p>The ElvClient handles all of this automatically. When a method is called, it will create the appropriate transaction and send the correct authorization token with the request.</p>
<p>The contract address of content can be determined by its ID, because the IDs of content in the fabric are multiformat hashes. This means that no additional information is needed to locate the appropriate contract when accessing content.</p>
<p>For example, the library with ID <code>ilibVdci1v3nUgXdMxMznXny5NfaPRN</code> has its contract located at the blockchain address <code>0x236ee22acab8810f75b726079a0b3d3afd505645</code>. </p>
<h4>Wallets and signers</h4><p>To perform the necessary blockchain interactions, the client requires a <em>signer</em>. This is an instance of an <a href="https://github.com/ethers-io/ethers.js/">ethers.js</a> wallet. ElvClient has a utility class <code>ElvWallet</code> to make handling this easier.</p>
<p>After creating the ElvClient instance, you can generate an <code>ElvWallet</code> for the client using <code>client.GenerateWallet()</code>. This class provides simple methods to generate signers from various information, as well as storing and retrieving signers by name. </p>
<p>Note: you do not need to use the account management functionality of the wallet, you can simply use the wallet to generate signer objects as needed. Omitting the name parameter when calling any of the AddAccount is valid - the signer will only be returned and not stored.</p>
<h4>Generating the wallet and adding accounts:</h4><pre class="prettyprint source lang-javascript"><code>const wallet = client.GenerateWallet();

// With decrypted private key (synchronous): 
const signer = wallet.AddAccount({
  accountName: &quot;Alice&quot;,
  privateKey: &quot;0xbf092a5c94988e2f7a1d00d0db309fc492fe38ddb57fc6d102d777373389c5e6&quot;
});

// With encrypted private key (asynchronous):
const signer = await wallet.AddAccountFromEncryptedPK({
  accountName: &quot;Bob&quot;,
  encryptedPrivateKey: {&quot;address&quot;:&quot;71b011b67dc8f5c323a34cd14b952721d5750c93&quot;,&quot;crypto&quot;:{&quot;cipher&quot;:&quot;aes-128-ctr&quot;,&quot;ciphertext&quot;:&quot;768c0b26476793e52c7e292b6b221fa4d7f82a7d20a7ccc042ce43c072f97f38&quot;,&quot;cipherparams&quot;:{&quot;iv&quot;:&quot;049e2bed69573f62da6576c21769b520&quot;},&quot;kdf&quot;:&quot;scrypt&quot;,&quot;kdfparams&quot;:{&quot;dklen&quot;:32,&quot;n&quot;:262144,&quot;p&quot;:1,&quot;r&quot;:8,&quot;salt&quot;:&quot;332b0f7730c580aa86b3ec8e79d228e9f76426bb328c468cb57e99e39132c29f&quot;},&quot;mac&quot;:&quot;36079b7f32edf1c3d8d1697313f8088c78be07627ffb6421f655409373fded79&quot;},&quot;id&quot;:&quot;8181d812-ab5e-4e5b-b023-e9049c2aec48&quot;,&quot;version&quot;:3},
  password: &quot;test&quot;
});

// Using mnemonics (synchronous)
const mnemonic = wallet.GenerateMnemonic();
// -> coin valve van maximum manual glow nurse puppy wish put sound session

const signer = wallet.AddAccountFromMnemonic({
  accountName: &quot;Carol&quot;,
  mnemonic: mnemonic
});

// It is valid to omit the accountName parameter
const signer = wallet.AddAccount({
  privateKey: &quot;0xbf092a5c94988e2f7a1d00d0db309fc492fe38ddb57fc6d102d777373389c5e6&quot;
});</code></pre><h4>Setting the client's signer</h4><p>After obtaining the signer through whatever means, you must set the signer for the client to use.</p>
<p>All blockchain transactions performed by ElvClient will use the signer set by the <code>SetSigner</code> method. An exception will be thrown if the signer is not set.</p>
<pre class="prettyprint source lang-javascript"><code>const signer = wallet.GetAccount({accountName: &quot;Alice&quot;});
client.SetSigner({signer});

client.CreateContentLibrary({
  libraryName: &quot;New Library&quot;
})</code></pre><h4>Account utilities</h4><h5>Getting account balance</h5><pre class="prettyprint source lang-javascript"><code>const balance = wallet.GetAccountBalance({accountName: &quot;Alice&quot;});

89.787462796</code></pre><h5>Generating signer's encrypted private key (keystore format)</h5><pre class="prettyprint source lang-javascript"><code>const encryptedPrivateKey = await wallet.GenerateEncryptedPrivateKey({accountName: &quot;Alice&quot;, password: &quot;test&quot;});

&quot;{\&quot;address\&quot;:\&quot;93cc134901c40f6164ab357f4f18bbf4aa058477\&quot;,\&quot;id\&quot;:\&quot;dc5b06ca-f284-4a47-875a-176d857f6d9d\&quot;,\&quot;version\&quot;:3,\&quot;Crypto\&quot;:{\&quot;cipher\&quot;:\&quot;aes-128-ctr\&quot;,\&quot;cipherparams\&quot;:{\&quot;iv\&quot;:\&quot;ca349dad2df26ed5786b987fd54e195d\&quot;},\&quot;ciphertext\&quot;:\&quot;c4e1d0e1bf21cb8e2c4c732040245ea65f22cd4af0666dc79da1b3fbe23c6a27\&quot;,\&quot;kdf\&quot;:\&quot;scrypt\&quot;,\&quot;kdfparams\&quot;:{\&quot;salt\&quot;:\&quot;27695860062f440d91d1863c37349a28518ed98799d0d96b8f9a39c9e23b953a\&quot;,\&quot;n\&quot;:131072,\&quot;dklen\&quot;:32,\&quot;p\&quot;:1,\&quot;r\&quot;:8},\&quot;mac\&quot;:\&quot;2b0fe21ba893c40ab193694ef2f86c7982138fc17b19148b25f65bfccdbb4fbd\&quot;}}&quot;</code></pre><p>Note: This method is equivalent to <code>signer.encrypt(password)</code> - if you already have the signer object, calling encrypt directly may be easier.</p>
<h3>Deploying custom contracts</h3><h4>Compilation and contract code handling</h4><p>In order to deploy custom contracts, the ABI and bytecode of the compiled contract are required. For further contract interaction, such as calling contract methods, only the ABI is necessary.</p>
<p>Contract compilation is outside the scope of this library, but there are many ways to get contracts compiled and the ABI and bytecode available to your javascript code. The following advice assumes the contracts are written in Solidity.</p>
<h5>Compilers:</h5><ul>
<li>Using the <a href="https://github.com/ethereum/solidity">Solidity compiler</a></li>
<li>Using <a href="https://github.com/trufflesuite/truffle">Truffle</a></li>
<li>Using <a href="https://www.npmjs.com/package/solc">solc-js</a> (node only)</li>
<li>Using <a href="https://github.com/ericxtang/browser-solc">browser-solc</a> (browser only)</li>
</ul>
<h5>Managing compiled contracts</h5><p>Once your contract has been compiled, there are several ways you can get the ABI and bytecode into your javascript environment.</p>
<p>From a usage perspective, the easiest way is to get this data into valid javascript. If you do not expect your contract code to change much, you can add the ABI and bytecode strings directly to your code.</p>
<p>This client relies on several of Eluvio's contracts. In order to easily pull these contracts in to the code and to allow us to minify this library into a single file with no dependencies, we compile these contracts and format them into easily importable javascript using a build script.</p>
<p> <code>./build/BuildContracts.js</code> is the script that compiles the contracts and generates the javascript files, and <code>./src/contracts</code> is where those javascript files are written. These scripts are then used in <code>./src/EthClient.js</code>.</p>
<p>Compiling to a JSON format would also be easily usable in a javascript environment. For example:</p>
<pre class="prettyprint source lang-json"><code>// Contract.json:
{
  &quot;abi&quot;: &lt;abi>,
  &quot;bytecode&quot;: &lt;bytecode>
}</code></pre><pre class="prettyprint source lang-javascript"><code>// UseContract.js
const contractData = require(&quot;Contract.json&quot;);

client.DeployContract({
  abi: contractData.abi,
  bytecode: contractData.bytecode,
  constructorArgs: []
})</code></pre><p>Other methods may be more difficult and prone to error due to the difficulty of importing non-javascript files into javascript.</p>
<ul>
<li>If you are using webpack, you can use the <a href="https://github.com/webpack-contrib/raw-loader">raw-loader</a> to import your compiled contract data.</li>
<li>On node.js, you can use fs to read files</li>
<li>In a browser, you can do an XHR or fetch request to access the file</li>
</ul>
<h5>Deploying contracts</h5><p>The ElvClient can be used to deploy custom contracts, provided the ABI and bytecode of the contract.</p>
<p>The arguments to both the contract constructor and contract methods are provided as an ordered array. Some arguments have special required formats - Bytes32 strings, for example. The FormatContractArguments helper can perform this formatting automatically by referencing the ABI.</p>
<p>For example, the second argument to this contract constructor is a bytes32 string:</p>
<pre class="prettyprint source lang-javascript"><code>const constructorArgs = client.FormatContractArguments({
  abi,
  methodName: &quot;constructor&quot;,
  args: [
    &quot;First Argument&quot;,
    &quot;Content Space&quot;,
    &quot;0x0000000000000000000000000000000000000000&quot;
  ]
});

/* Result

[ 'New library',
  '0x436f6e74656e7420537061636500000000000000000000000000000000000000',
  '0x0000000000000000000000000000000000000000' ]
*/</code></pre><p>It is recommended to always run your arguments array through the FormatContractArguments method before deploying a contract or calling a contract method unless you explicitly handle argument formatting yourself.</p>
<p>To deploy a contract, simply pass the ABI, bytecode, and formatted constructor arguments.</p>
<pre class="prettyprint source lang-javascript"><code>return await client.DeployContract({
  abi,
  bytecode,
  constructorArgs
});</code></pre><p>Calling a method on a deployed contract is similarly simple:</p>
<pre class="prettyprint source lang-javascript"><code>return await client.CallContractMethod({
  contractAddress,
  abi,
  methodName: &quot;myMethod&quot;,
  methodArgs
});</code></pre><h3>Other blockchain interaction</h3><p>The signer object, as described above, is an instance of an <a href="https://github.com/ethers-io/ethers.js/">ethers.js</a> wallet that is connected to the client's specified blockchain (provider). It can be used independently of the ElvClient to do anything outlined in the <a href="https://docs.ethers.io/ethers.js/html/api-wallet.html">documentation</a>.</p>
<p>This signer can be used in conjunction with the ethers.js library, or even another ethereum library like web3 (by extracting the private key), to deploy contracts, sign transactions and perform other functions not explicitly supported in the ElvClient.</p>
<p>Refer to src/EthClient.js to see how ElvClient uses ethers.js to interact with the blockchain.</p>
<h3>Error handling</h3><p>Error checking is performed by the client for all queries. If an error occurs or if the response is <code>!.ok</code> (response code not in 200 range), an error of the following format will be thrown:</p>
<pre class="prettyprint source lang-json"><code>{ 
  &quot;status&quot;: 500,
  &quot;statusText&quot;: &quot;request to http://localhost:8008/qlibs failed, reason: connect ECONNREFUSED 127.0.0.1:8008&quot;,
  &quot;url&quot;: &quot;http://localhost:8008/qlibs&quot; 
} </code></pre><p>These should be caught and handled using .catch or try/catch blocks</p>
<pre class="prettyprint source lang-javascript"><code>// Using .catch
 client.ContentLibraries()
   .then(libraryIds => console.log(libraryIds))
   .catch(error => console.log(error.statusText));

// Using async/await
try {
  let libraryIds = await client.ContentLibraries();
  console.log(libraryIds);
} catch(error) {
  console.log(error.statusText);
}</code></pre><p>See <code>./test/TestMethods.js</code> for full working examples.</p>
<h3>Content Object Verification</h3><pre class="prettyprint source lang-javascript"><code>// Using promise:
client.VerifyContentObject({
  partHash: &quot;hq__QmWapFBE3sZ8z7cipsrHtE97VjtJ6rfiCVvWkC7mgYfLVb&quot;,
  libraryId: &quot;ilibWL9CAVcQYZPHB58SDRMkwQ&quot;
}).then(result => { console.log(result); });


// Using async / await
let result = await client.VerifyContentObject({
  partHash: &quot;hq__QmWapFBE3sZ8z7cipsrHtE97VjtJ6rfiCVvWkC7mgYfLVb&quot;,
  libraryId: &quot;ilibWL9CAVcQYZPHB58SDRMkwQ&quot;
});
console.log(result);

/* Result:

{
  &quot;hash&quot;: &quot;hq__QmchT4PFtSdbLnQjMNeyoMB42jncU6QwiZe4wS1ymvgVK1&quot;,
  &quot;qref&quot;: {
    &quot;valid&quot;: true,
    &quot;hash&quot;: &quot;hqp_QmchT4PFtSdbLnQjMNeyoMB42jncU6QwiZe4wS1ymvgVK1&quot;
  },
  &quot;qmd&quot;: {
    &quot;valid&quot;: true,
    &quot;hash&quot;: &quot;hqp_QmQ4V6Zi4Z4oGkAiZEYFoYaK5gs55r458dbJXer5hcS4ZB&quot;,
    &quot;check&quot;: {
      &quot;valid&quot;: true,
      &quot;invalidValues&quot;: []
    }
  },
  &quot;qstruct&quot;: {
    &quot;valid&quot;: true,
    &quot;hash&quot;: &quot;hqp_QmNweqiWD85twj1f3HmhmSANoSpdra7cJzraZYetrkxh4c&quot;,
    &quot;parts&quot;: [
      {
        &quot;hash&quot;: &quot;hqp_QmSYmLooWwynAzeJ54Gn1dMBnXnQTj6FMSSs3tLusCQFFB&quot;,
        &quot;size&quot;: 17
      }
    ]
  },
  &quot;valid&quot;: true
}
*/

// Library ID is optional
// If provided, up to 5 metadata fields will be checked against the /meta endpoint
// If not provided, additional metadata check will not be performed
let result = await client.VerifyContentObject({
  partHash: &quot;hq__QmWapFBE3sZ8z7cipsrHtE97VjtJ6rfiCVvWkC7mgYfLVb&quot;
})
console.log(result);

/*
Result:

{
  &quot;hash&quot;: &quot;hq__QmchT4PFtSdbLnQjMNeyoMB42jncU6QwiZe4wS1ymvgVK1&quot;,
  &quot;qref&quot;: {
    &quot;valid&quot;: true,
    &quot;hash&quot;: &quot;hqp_QmchT4PFtSdbLnQjMNeyoMB42jncU6QwiZe4wS1ymvgVK1&quot;
  },
  &quot;qmd&quot;: {
    &quot;valid&quot;: true,
    &quot;hash&quot;: &quot;hqp_QmQ4V6Zi4Z4oGkAiZEYFoYaK5gs55r458dbJXer5hcS4ZB&quot;
  },
  &quot;qstruct&quot;: {
    &quot;valid&quot;: true,
    &quot;hash&quot;: &quot;hqp_QmNweqiWD85twj1f3HmhmSANoSpdra7cJzraZYetrkxh4c&quot;,
    &quot;parts&quot;: [
      {
        &quot;hash&quot;: &quot;hqp_QmSYmLooWwynAzeJ54Gn1dMBnXnQTj6FMSSs3tLusCQFFB&quot;,
        &quot;size&quot;: 17
      }
    ]
  },
  &quot;valid&quot;: true
}
*/


// Both &quot;hqp_&quot; and &quot;hq__&quot; format are acceptable
let result = await client.VerifyContentObject({
  partHash: &quot;hq__QmWuCKNpTeVp2mUP1sQwaJLVVTWvepxCqWks3Mrt2UZCRQ&quot;
})
console.log(result);


// Example error result:
/*
{
  &quot;valid&quot;: false,
  &quot;part&quot;: {
    &quot;valid&quot;: true
  },
  &quot;metadata&quot;: {
    &quot;valid&quot;: true,
    &quot;check&quot;: {
      &quot;valid&quot;: false,
      &quot;invalidValues&quot;: [
        {
          &quot;key&quot;: &quot;eluv.version&quot;,
          &quot;cborValue&quot;: &quot;2asd&quot;,
          &quot;metadataValue&quot;: &quot;2&quot;
        },
        {
          &quot;key&quot;: &quot;eluv.contract_address&quot;,
          &quot;cborValue&quot;: &quot;0xc6629e8fad87eb91f6faedcbd7802fc71f5be99dasd&quot;,
          &quot;metadataValue&quot;: &quot;0xc6629e8fad87eb91f6faedcbd7802fc71f5be99d&quot;
        },
        {
          &quot;key&quot;: &quot;eluv.access.type&quot;,
          &quot;cborValue&quot;: &quot;freeasd&quot;,
          &quot;metadataValue&quot;: &quot;free&quot;
        },
        {
          &quot;key&quot;: &quot;name&quot;,
          &quot;cborValue&quot;: &quot;best contentasd&quot;,
          &quot;metadataValue&quot;: &quot;best content&quot;
        },
        {
          &quot;key&quot;: &quot;image&quot;,
          &quot;cborValue&quot;: &quot;hqp_QmU3QKSgShnQQSnKdmEMDgo4AimNHg3JHy4SY7DymVy5WNasd&quot;,
          &quot;metadataValue&quot;: &quot;hqp_QmU3QKSgShnQQSnKdmEMDgo4AimNHg3JHy4SY7DymVy5WN&quot;
        }
      ]
    }
  },
  &quot;struct&quot;: {
    &quot;valid&quot;: false,
    &quot;error&quot;: &quot;Invalid typed array length: 8445309507702284000&quot;
  }
}
*/</code></pre><h3>IFrame Client</h3><p>The API client can be used transparently by an restricted IFrame using the FrameClient (./ElvFrameClient-min.js).</p>
<p>See ./test/frames/Parent.html and ./test/frames/Child.html for example usage</p>
<p>NOTE: Raw response objects cannot be passed in message. When using non-json endpoints (e.g. DownloadPart), you must specify a valid type in the format field or accept the default blob format. The available formats correspond to Response methods (.json(), .blob(), .text(), etc.)</p>
    </article>
  </section>


    



        <footer class="footer">
          Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
        </footer>
      </div>
    </div>
  </div>

  <script>
    // Format and add line numbers to code
    prettyPrint();
  </script>

  <script type="text/javascript" src="scripts/utils.js"></script>

  </body>
</html>