

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="images/favicon.png" >

  <title>
    Notifications.js - Documentation
  </title>

  <script src="scripts/prettify/prettify.js"></script>
  <script src="scripts/prettify/lang-css.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/elv-jsdoc.css">
  <link type="text/css" rel="stylesheet" href="styles/elv-prettify-jsdoc.css">
</head>

<body>
  <div class="layout-container">
    <nav class="nav-container">
      <div class="header">
        <a href="index.html">
          <img class="logo" src="images/logo-dark.png" />
        </a>
        <div class="title">
          Eluvio Wallet Client
        </div>
      </div>
      <div class="nav-content">
        <h3>Classes</h3><ul><li id="ElvWalletClient-nav">
          <div data-name="ElvWalletClient" class="class-link-container"><a class="class-link">ElvWalletClient</a></div><ul class='methods'><h4 class="methodGroupHeader">Constructor</h4><li data-type="method" id="ElvWalletClient-ElvWalletClient-nav"><a href="ElvWalletClient.html" class="method-link">ElvWalletClient</a></li><h4 class="methodGroupHeader">Authorization</h4><li data-type="method" id="ElvWalletClient-Authenticate-nav"><a href="ElvWalletClient.html#Authenticate" class="method-link">Authenticate</a></li><li data-type="method" id="ElvWalletClient-AuthenticateExternalWallet-nav"><a href="ElvWalletClient.html#AuthenticateExternalWallet" class="method-link">AuthenticateExternalWallet</a></li><li data-type="method" id="ElvWalletClient-AuthenticateOAuth-nav"><a href="ElvWalletClient.html#AuthenticateOAuth" class="method-link">AuthenticateOAuth</a></li><h4 class="methodGroupHeader">Initialization</h4><li data-type="method" id="ElvWalletClient-Initialize-nav"><a href="ElvWalletClient.html#.Initialize" class="method-link">Initialize</a></li><h4 class="methodGroupHeader">Login</h4><li data-type="method" id="ElvWalletClient-LogIn-nav"><a href="ElvWalletClient.html#LogIn" class="method-link">LogIn</a></li><li data-type="method" id="ElvWalletClient-LogOut-nav"><a href="ElvWalletClient.html#LogOut" class="method-link">LogOut</a></li><h4 class="methodGroupHeader">Signatures</h4><li data-type="method" id="ElvWalletClient-CanSign-nav"><a href="ElvWalletClient.html#CanSign" class="method-link">CanSign</a></li><li data-type="method" id="ElvWalletClient-PersonalSign-nav"><a href="ElvWalletClient.html#PersonalSign" class="method-link">PersonalSign</a></li><h4 class="methodGroupHeader">Methods</h4><li data-type="method" id="ElvWalletClient-ClientAuthToken-nav"><a href="ElvWalletClient.html#ClientAuthToken" class="method-link">ClientAuthToken</a></li></ul></li></ul><h3>Modules</h3><ul><li id="ClientMethods-nav">
          <div data-name="ClientMethods" class="class-link-container"><a class="class-link">ClientMethods</a></div><ul class='methods'><li data-type="method" id="ClientMethods-ClientMethods-nav"><a href="module-ClientMethods.html" class="method-link">ClientMethods</a></li><h4 class="methodGroupHeader">Leaderboard</h4><li data-type="method" id="ClientMethods-Leaderboard-nav"><a href="module-ClientMethods.html#.Leaderboard" class="method-link">Leaderboard</a></li><h4 class="methodGroupHeader">Listings</h4><li data-type="method" id="ClientMethods-CreateListing-nav"><a href="module-ClientMethods.html#.CreateListing" class="method-link">CreateListing</a></li><li data-type="method" id="ClientMethods-Listing-nav"><a href="module-ClientMethods.html#.Listing" class="method-link">Listing</a></li><li data-type="method" id="ClientMethods-ListingAttributes-nav"><a href="module-ClientMethods.html#.ListingAttributes" class="method-link">ListingAttributes</a></li><li data-type="method" id="ClientMethods-ListingEditionNames-nav"><a href="module-ClientMethods.html#.ListingEditionNames" class="method-link">ListingEditionNames</a></li><li data-type="method" id="ClientMethods-ListingNames-nav"><a href="module-ClientMethods.html#.ListingNames" class="method-link">ListingNames</a></li><li data-type="method" id="ClientMethods-ListingStats-nav"><a href="module-ClientMethods.html#.ListingStats" class="method-link">ListingStats</a></li><li data-type="method" id="ClientMethods-ListingStatus-nav"><a href="module-ClientMethods.html#.ListingStatus" class="method-link">ListingStatus</a></li><li data-type="method" id="ClientMethods-Listings-nav"><a href="module-ClientMethods.html#.Listings" class="method-link">Listings</a></li><li data-type="method" id="ClientMethods-RemoveListing-nav"><a href="module-ClientMethods.html#.RemoveListing" class="method-link">RemoveListing</a></li><li data-type="method" id="ClientMethods-Sales-nav"><a href="module-ClientMethods.html#.Sales" class="method-link">Sales</a></li><li data-type="method" id="ClientMethods-SalesNames-nav"><a href="module-ClientMethods.html#.SalesNames" class="method-link">SalesNames</a></li><li data-type="method" id="ClientMethods-SalesStats-nav"><a href="module-ClientMethods.html#.SalesStats" class="method-link">SalesStats</a></li><li data-type="method" id="ClientMethods-Transfers-nav"><a href="module-ClientMethods.html#.Transfers" class="method-link">Transfers</a></li><h4 class="methodGroupHeader">Marketplaces</h4><li data-type="method" id="ClientMethods-AvailableMarketplaces-nav"><a href="module-ClientMethods.html#.AvailableMarketplaces" class="method-link">AvailableMarketplaces</a></li><li data-type="method" id="ClientMethods-Marketplace-nav"><a href="module-ClientMethods.html#.Marketplace" class="method-link">Marketplace</a></li><li data-type="method" id="ClientMethods-MarketplaceCSS-nav"><a href="module-ClientMethods.html#.MarketplaceCSS" class="method-link">MarketplaceCSS</a></li><li data-type="method" id="ClientMethods-MarketplaceInfo-nav"><a href="module-ClientMethods.html#.MarketplaceInfo" class="method-link">MarketplaceInfo</a></li><li data-type="method" id="ClientMethods-MarketplaceStock-nav"><a href="module-ClientMethods.html#.MarketplaceStock" class="method-link">MarketplaceStock</a></li><h4 class="methodGroupHeader">NFTs</h4><li data-type="method" id="ClientMethods-NFT-nav"><a href="module-ClientMethods.html#.NFT" class="method-link">NFT</a></li><li data-type="method" id="ClientMethods-NFTContractStats-nav"><a href="module-ClientMethods.html#.NFTContractStats" class="method-link">NFTContractStats</a></li><li data-type="method" id="ClientMethods-TransferNFT-nav"><a href="module-ClientMethods.html#.TransferNFT" class="method-link">TransferNFT</a></li><h4 class="methodGroupHeader">Offers</h4><li data-type="method" id="ClientMethods-AcceptMarketplaceOffer-nav"><a href="module-ClientMethods.html#.AcceptMarketplaceOffer" class="method-link">AcceptMarketplaceOffer</a></li><li data-type="method" id="ClientMethods-CreateMarketplaceOffer-nav"><a href="module-ClientMethods.html#.CreateMarketplaceOffer" class="method-link">CreateMarketplaceOffer</a></li><li data-type="method" id="ClientMethods-MarketplaceOffers-nav"><a href="module-ClientMethods.html#.MarketplaceOffers" class="method-link">MarketplaceOffers</a></li><li data-type="method" id="ClientMethods-RejectMarketplaceOffer-nav"><a href="module-ClientMethods.html#.RejectMarketplaceOffer" class="method-link">RejectMarketplaceOffer</a></li><li data-type="method" id="ClientMethods-RemoveMarketplaceOffer-nav"><a href="module-ClientMethods.html#.RemoveMarketplaceOffer" class="method-link">RemoveMarketplaceOffer</a></li><h4 class="methodGroupHeader">Purchase</h4><li data-type="method" id="ClientMethods-ClaimItem-nav"><a href="module-ClientMethods.html#.ClaimItem" class="method-link">ClaimItem</a></li><li data-type="method" id="ClientMethods-PurchaseItem-nav"><a href="module-ClientMethods.html#.PurchaseItem" class="method-link">PurchaseItem</a></li><li data-type="method" id="ClientMethods-PurchaseListing-nav"><a href="module-ClientMethods.html#.PurchaseListing" class="method-link">PurchaseListing</a></li><h4 class="methodGroupHeader">Status</h4><li data-type="method" id="ClientMethods-ClaimStatus-nav"><a href="module-ClientMethods.html#.ClaimStatus" class="method-link">ClaimStatus</a></li><li data-type="method" id="ClientMethods-CollectionRedemptionStatus-nav"><a href="module-ClientMethods.html#.CollectionRedemptionStatus" class="method-link">CollectionRedemptionStatus</a></li><li data-type="method" id="ClientMethods-ListingPurchaseStatus-nav"><a href="module-ClientMethods.html#.ListingPurchaseStatus" class="method-link">ListingPurchaseStatus</a></li><li data-type="method" id="ClientMethods-PackOpenStatus-nav"><a href="module-ClientMethods.html#.PackOpenStatus" class="method-link">PackOpenStatus</a></li><li data-type="method" id="ClientMethods-PurchaseStatus-nav"><a href="module-ClientMethods.html#.PurchaseStatus" class="method-link">PurchaseStatus</a></li><li data-type="method" id="ClientMethods-RedeemableOfferStatus-nav"><a href="module-ClientMethods.html#.RedeemableOfferStatus" class="method-link">RedeemableOfferStatus</a></li><h4 class="methodGroupHeader">Tenants</h4><li data-type="method" id="ClientMethods-ExchangeRate-nav"><a href="module-ClientMethods.html#.ExchangeRate" class="method-link">ExchangeRate</a></li><li data-type="method" id="ClientMethods-TenantCSS-nav"><a href="module-ClientMethods.html#.TenantCSS" class="method-link">TenantCSS</a></li><li data-type="method" id="ClientMethods-TenantConfiguration-nav"><a href="module-ClientMethods.html#.TenantConfiguration" class="method-link">TenantConfiguration</a></li><h4 class="methodGroupHeader">User</h4><li data-type="method" id="ClientMethods-UserAddress-nav"><a href="module-ClientMethods.html#.UserAddress" class="method-link">UserAddress</a></li><li data-type="method" id="ClientMethods-UserInfo-nav"><a href="module-ClientMethods.html#.UserInfo" class="method-link">UserInfo</a></li><li data-type="method" id="ClientMethods-UserItemAttributes-nav"><a href="module-ClientMethods.html#.UserItemAttributes" class="method-link">UserItemAttributes</a></li><li data-type="method" id="ClientMethods-UserItemEditionNames-nav"><a href="module-ClientMethods.html#.UserItemEditionNames" class="method-link">UserItemEditionNames</a></li><li data-type="method" id="ClientMethods-UserItemNames-nav"><a href="module-ClientMethods.html#.UserItemNames" class="method-link">UserItemNames</a></li><li data-type="method" id="ClientMethods-UserItems-nav"><a href="module-ClientMethods.html#.UserItems" class="method-link">UserItems</a></li><li data-type="method" id="ClientMethods-UserListings-nav"><a href="module-ClientMethods.html#.UserListings" class="method-link">UserListings</a></li><li data-type="method" id="ClientMethods-UserSales-nav"><a href="module-ClientMethods.html#.UserSales" class="method-link">UserSales</a></li><li data-type="method" id="ClientMethods-UserTransfers-nav"><a href="module-ClientMethods.html#.UserTransfers" class="method-link">UserTransfers</a></li><li data-type="method" id="ClientMethods-UserWalletBalance-nav"><a href="module-ClientMethods.html#.UserWalletBalance" class="method-link">UserWalletBalance</a></li><h4 class="methodGroupHeader">Voting</h4><li data-type="method" id="ClientMethods-CastVote-nav"><a href="module-ClientMethods.html#.CastVote" class="method-link">CastVote</a></li><li data-type="method" id="ClientMethods-RevokeVote-nav"><a href="module-ClientMethods.html#.RevokeVote" class="method-link">RevokeVote</a></li><li data-type="method" id="ClientMethods-VoteStatus-nav"><a href="module-ClientMethods.html#.VoteStatus" class="method-link">VoteStatus</a></li></ul></li><li id="Notifications-nav">
          <div data-name="Notifications" class="class-link-container"><a class="class-link">Notifications</a></div><ul class='methods'><li data-type="method" id="Notifications-Notifications-nav"><a href="module-Notifications.html" class="method-link">Notifications</a></li><h4 class="methodGroupHeader">Notifications</h4><li data-type="method" id="Notifications-AddNotificationListener-nav"><a href="module-Notifications.html#.AddNotificationListener" class="method-link">AddNotificationListener</a></li><li data-type="method" id="Notifications-Notifications-nav"><a href="module-Notifications.html#.Notifications" class="method-link">Notifications</a></li><li data-type="method" id="Notifications-PushNotification-nav"><a href="module-Notifications.html#.PushNotification" class="method-link">PushNotification</a></li></ul></li><li id="ProfileMethods-nav">
          <div data-name="ProfileMethods" class="class-link-container"><a class="class-link">ProfileMethods</a></div><ul class='methods'><li data-type="method" id="ProfileMethods-ProfileMethods-nav"><a href="module-ProfileMethods.html" class="method-link">ProfileMethods</a></li><h4 class="methodGroupHeader">Profile</h4><li data-type="method" id="ProfileMethods-Profile-nav"><a href="module-ProfileMethods.html#.Profile" class="method-link">Profile</a></li><h4 class="methodGroupHeader">ProfileMetadata</h4><li data-type="method" id="ProfileMethods-ProfileMetadata-nav"><a href="module-ProfileMethods.html#.ProfileMetadata" class="method-link">ProfileMetadata</a></li><li data-type="method" id="ProfileMethods-RemoveProfileMetadata-nav"><a href="module-ProfileMethods.html#.RemoveProfileMetadata" class="method-link">RemoveProfileMetadata</a></li><li data-type="method" id="ProfileMethods-SetProfileMetadata-nav"><a href="module-ProfileMethods.html#.SetProfileMetadata" class="method-link">SetProfileMetadata</a></li></ul></li></ul>
      </div>
    </nav>

    <div class="main">
      <div class="header"></div>
      <div class="main-content">
        
        <h1 class="page-title">
          Notifications.js
        </h1>
        

        
      

<a class="button" href="Notifications.html">Back</a>
<div class="source-container">
  <pre class="prettyprint source linenums"><code>/**
 * Methods related to notifications for the current user.
 *
 * @module Notifications
 */


const Utils = require("../Utils");
const UrlJoin = require("url-join");

const NotificationPath = ({network, path}) => {
  return UrlJoin("/push", network === "main" ? "/main" : "/dv3", path);
};

/**
 * Push a notification to a user
 *
 * @methodGroup Notifications
 * @param {string} tenantId - The tenant associated with this notification
 * @param {string} eventType - The type of the notification
 * @param {(Object | string)=} data - Data associated with this notification
 * @param {string=} userAddress - Address of the user to notify. If not specified, it will be sent to the current user.
 */
exports.PushNotification = async function({tenantId, eventType, data, userAddress}) {
  await this.stateStoreClient.Request({
    method: "POST",
    path: NotificationPath({network: this.network, path: UrlJoin("notify_user", userAddress || this.UserAddress(), tenantId, eventType)}),
    body: data,
    headers: {
      Authorization: `Bearer ${this.AuthToken()}`
    }
  });
};

/**
 * Add a listener to receive new notifications.
 *
 * @methodGroup Notifications
 * @param {function} onMessage - Callback invoked when a new notification is received
 *
 * @returns {Promise&lt;EventSource>} - An EventSource instance listening for notifications. Use source.close() to close the listener.
 */
exports.AddNotificationListener = async function({onMessage}) {
  if(!onMessage) {
    throw Error("Eluvio Wallet Client: No onMessage callback provided to AddNotificationListener");
  }

  const url = new URL(this.stateStoreClient.BaseURI().toString());
  url.pathname = NotificationPath({network: this.network, path: UrlJoin("register", this.UserAddress(), this.AuthToken())});
  const source = new EventSource(url);
  source.onmessage = event => {
    let parsedMessage = JSON.parse(event.data);

    try {
      parsedMessage.data = JSON.parse(parsedMessage.data);
    // eslint-disable-next-line no-empty
    } catch(error) {}

    onMessage(parsedMessage);
  };

  return source;
};

/**
 * Retrieve notifications for the current user.
 *
 * @methodGroup Notifications
 * @param {integer=} limit=10 - The maximum number of notifications to return
 * @param {string=} tenantId - Filter notifications to only those related to the specified tenant
 * @param {Array&lt;string>=} types - Filter notifications to only the specified types
 * @param {string=} offsetId - Return notifications older than the specified ID
 *
 * @returns {Promise&lt;Array&lt;Object>>} - A list of notifications for the specified parameters
 */
exports.Notifications = async function({tenantId, types, offsetId, limit=10}={}) {
  let queryParams = { limit };

  if(tenantId) {
    queryParams.tenant_id = tenantId;
  }

  if(types) {
    queryParams.types = Array.isArray(types) ? types.join(",") : types;
  }

  if(offsetId) {
    queryParams.offset_by = offsetId;
  }

  const {records} = await Utils.ResponseToJson(
    this.stateStoreClient.Request({
      method: "GET",
      path: NotificationPath({network: this.network, path: UrlJoin("history", this.UserAddress())}),
      queryParams,
      headers: {
        Authorization: `Bearer ${this.AuthToken()}`
      }
    })
  );

  return records.map(record => {
    try {
      record.data = JSON.parse(record.data);
    // eslint-disable-next-line no-empty
    } catch(error) {}

    return record;
  });
};
</code></pre>
</div>

    



        <footer class="footer">
          Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a>
        </footer>
      </div>
    </div>
  </div>

  <script>
    // Format and add line numbers to code
    prettyPrint();
  </script>

  <script type="text/javascript" src="scripts/utils.js"></script>

  </body>
</html>
