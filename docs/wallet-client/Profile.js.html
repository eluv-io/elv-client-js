

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="images/favicon.png" >

  <title>
    Profile.js - Documentation
  </title>

  <script src="scripts/prettify/prettify.js"></script>
  <script src="scripts/prettify/lang-css.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/elv-jsdoc.css">
  <link type="text/css" rel="stylesheet" href="styles/elv-prettify-jsdoc.css">
</head>

<body>
  <div class="layout-container">
    <nav class="nav-container">
      <div class="header">
        <a href="index.html">
          <img class="logo" src="images/logo-dark.png" />
        </a>
        <div class="title">
          Eluvio Wallet Client
        </div>
      </div>
      <div class="nav-content">
        <h3>Classes</h3><ul><li id="ElvWalletClient-nav">
          <div data-name="ElvWalletClient" class="class-link-container"><a class="class-link">ElvWalletClient</a></div><ul class='methods'><h4 class="methodGroupHeader">Constructor</h4><li data-type="method" id="ElvWalletClient-ElvWalletClient-nav"><a href="ElvWalletClient.html" class="method-link">ElvWalletClient</a></li><h4 class="methodGroupHeader">Authorization</h4><li data-type="method" id="ElvWalletClient-Authenticate-nav"><a href="ElvWalletClient.html#Authenticate" class="method-link">Authenticate</a></li><li data-type="method" id="ElvWalletClient-AuthenticateExternalWallet-nav"><a href="ElvWalletClient.html#AuthenticateExternalWallet" class="method-link">AuthenticateExternalWallet</a></li><li data-type="method" id="ElvWalletClient-AuthenticateOAuth-nav"><a href="ElvWalletClient.html#AuthenticateOAuth" class="method-link">AuthenticateOAuth</a></li><h4 class="methodGroupHeader">Initialization</h4><li data-type="method" id="ElvWalletClient-Initialize-nav"><a href="ElvWalletClient.html#.Initialize" class="method-link">Initialize</a></li><h4 class="methodGroupHeader">Login</h4><li data-type="method" id="ElvWalletClient-LogIn-nav"><a href="ElvWalletClient.html#LogIn" class="method-link">LogIn</a></li><li data-type="method" id="ElvWalletClient-LogOut-nav"><a href="ElvWalletClient.html#LogOut" class="method-link">LogOut</a></li><h4 class="methodGroupHeader">Signatures</h4><li data-type="method" id="ElvWalletClient-CanSign-nav"><a href="ElvWalletClient.html#CanSign" class="method-link">CanSign</a></li><li data-type="method" id="ElvWalletClient-PersonalSign-nav"><a href="ElvWalletClient.html#PersonalSign" class="method-link">PersonalSign</a></li><h4 class="methodGroupHeader">Methods</h4><li data-type="method" id="ElvWalletClient-ClientAuthToken-nav"><a href="ElvWalletClient.html#ClientAuthToken" class="method-link">ClientAuthToken</a></li></ul></li></ul><h3>Modules</h3><ul><li id="ClientMethods-nav">
          <div data-name="ClientMethods" class="class-link-container"><a class="class-link">ClientMethods</a></div><ul class='methods'><li data-type="method" id="ClientMethods-ClientMethods-nav"><a href="module-ClientMethods.html" class="method-link">ClientMethods</a></li><h4 class="methodGroupHeader">Leaderboard</h4><li data-type="method" id="ClientMethods-Leaderboard-nav"><a href="module-ClientMethods.html#.Leaderboard" class="method-link">Leaderboard</a></li><h4 class="methodGroupHeader">Listings</h4><li data-type="method" id="ClientMethods-CreateListing-nav"><a href="module-ClientMethods.html#.CreateListing" class="method-link">CreateListing</a></li><li data-type="method" id="ClientMethods-Listing-nav"><a href="module-ClientMethods.html#.Listing" class="method-link">Listing</a></li><li data-type="method" id="ClientMethods-ListingAttributes-nav"><a href="module-ClientMethods.html#.ListingAttributes" class="method-link">ListingAttributes</a></li><li data-type="method" id="ClientMethods-ListingEditionNames-nav"><a href="module-ClientMethods.html#.ListingEditionNames" class="method-link">ListingEditionNames</a></li><li data-type="method" id="ClientMethods-ListingNames-nav"><a href="module-ClientMethods.html#.ListingNames" class="method-link">ListingNames</a></li><li data-type="method" id="ClientMethods-Listings-nav"><a href="module-ClientMethods.html#.Listings" class="method-link">Listings</a></li><li data-type="method" id="ClientMethods-ListingStats-nav"><a href="module-ClientMethods.html#.ListingStats" class="method-link">ListingStats</a></li><li data-type="method" id="ClientMethods-ListingStatus-nav"><a href="module-ClientMethods.html#.ListingStatus" class="method-link">ListingStatus</a></li><li data-type="method" id="ClientMethods-RemoveListing-nav"><a href="module-ClientMethods.html#.RemoveListing" class="method-link">RemoveListing</a></li><li data-type="method" id="ClientMethods-Sales-nav"><a href="module-ClientMethods.html#.Sales" class="method-link">Sales</a></li><li data-type="method" id="ClientMethods-SalesNames-nav"><a href="module-ClientMethods.html#.SalesNames" class="method-link">SalesNames</a></li><li data-type="method" id="ClientMethods-SalesStats-nav"><a href="module-ClientMethods.html#.SalesStats" class="method-link">SalesStats</a></li><li data-type="method" id="ClientMethods-Transfers-nav"><a href="module-ClientMethods.html#.Transfers" class="method-link">Transfers</a></li><h4 class="methodGroupHeader">Marketplaces</h4><li data-type="method" id="ClientMethods-AvailableMarketplaces-nav"><a href="module-ClientMethods.html#.AvailableMarketplaces" class="method-link">AvailableMarketplaces</a></li><li data-type="method" id="ClientMethods-Marketplace-nav"><a href="module-ClientMethods.html#.Marketplace" class="method-link">Marketplace</a></li><li data-type="method" id="ClientMethods-MarketplaceCSS-nav"><a href="module-ClientMethods.html#.MarketplaceCSS" class="method-link">MarketplaceCSS</a></li><li data-type="method" id="ClientMethods-MarketplaceInfo-nav"><a href="module-ClientMethods.html#.MarketplaceInfo" class="method-link">MarketplaceInfo</a></li><li data-type="method" id="ClientMethods-MarketplaceStock-nav"><a href="module-ClientMethods.html#.MarketplaceStock" class="method-link">MarketplaceStock</a></li><h4 class="methodGroupHeader">NFTs</h4><li data-type="method" id="ClientMethods-NFT-nav"><a href="module-ClientMethods.html#.NFT" class="method-link">NFT</a></li><li data-type="method" id="ClientMethods-NFTContractStats-nav"><a href="module-ClientMethods.html#.NFTContractStats" class="method-link">NFTContractStats</a></li><li data-type="method" id="ClientMethods-TransferNFT-nav"><a href="module-ClientMethods.html#.TransferNFT" class="method-link">TransferNFT</a></li><h4 class="methodGroupHeader">Purchase</h4><li data-type="method" id="ClientMethods-ClaimItem-nav"><a href="module-ClientMethods.html#.ClaimItem" class="method-link">ClaimItem</a></li><h4 class="methodGroupHeader">Status</h4><li data-type="method" id="ClientMethods-ClaimStatus-nav"><a href="module-ClientMethods.html#.ClaimStatus" class="method-link">ClaimStatus</a></li><li data-type="method" id="ClientMethods-CollectionRedemptionStatus-nav"><a href="module-ClientMethods.html#.CollectionRedemptionStatus" class="method-link">CollectionRedemptionStatus</a></li><li data-type="method" id="ClientMethods-ListingPurchaseStatus-nav"><a href="module-ClientMethods.html#.ListingPurchaseStatus" class="method-link">ListingPurchaseStatus</a></li><li data-type="method" id="ClientMethods-PackOpenStatus-nav"><a href="module-ClientMethods.html#.PackOpenStatus" class="method-link">PackOpenStatus</a></li><li data-type="method" id="ClientMethods-PurchaseStatus-nav"><a href="module-ClientMethods.html#.PurchaseStatus" class="method-link">PurchaseStatus</a></li><h4 class="methodGroupHeader">Tenants</h4><li data-type="method" id="ClientMethods-ExchangeRate-nav"><a href="module-ClientMethods.html#.ExchangeRate" class="method-link">ExchangeRate</a></li><li data-type="method" id="ClientMethods-TenantConfiguration-nav"><a href="module-ClientMethods.html#.TenantConfiguration" class="method-link">TenantConfiguration</a></li><h4 class="methodGroupHeader">User</h4><li data-type="method" id="ClientMethods-UserAddress-nav"><a href="module-ClientMethods.html#.UserAddress" class="method-link">UserAddress</a></li><li data-type="method" id="ClientMethods-UserInfo-nav"><a href="module-ClientMethods.html#.UserInfo" class="method-link">UserInfo</a></li><li data-type="method" id="ClientMethods-UserItemAttributes-nav"><a href="module-ClientMethods.html#.UserItemAttributes" class="method-link">UserItemAttributes</a></li><li data-type="method" id="ClientMethods-UserItemEditionNames-nav"><a href="module-ClientMethods.html#.UserItemEditionNames" class="method-link">UserItemEditionNames</a></li><li data-type="method" id="ClientMethods-UserItemInfo-nav"><a href="module-ClientMethods.html#.UserItemInfo" class="method-link">UserItemInfo</a></li><li data-type="method" id="ClientMethods-UserItemNames-nav"><a href="module-ClientMethods.html#.UserItemNames" class="method-link">UserItemNames</a></li><li data-type="method" id="ClientMethods-UserItems-nav"><a href="module-ClientMethods.html#.UserItems" class="method-link">UserItems</a></li><li data-type="method" id="ClientMethods-UserListings-nav"><a href="module-ClientMethods.html#.UserListings" class="method-link">UserListings</a></li><li data-type="method" id="ClientMethods-UserSales-nav"><a href="module-ClientMethods.html#.UserSales" class="method-link">UserSales</a></li><li data-type="method" id="ClientMethods-UserTransfers-nav"><a href="module-ClientMethods.html#.UserTransfers" class="method-link">UserTransfers</a></li><li data-type="method" id="ClientMethods-UserWalletBalance-nav"><a href="module-ClientMethods.html#.UserWalletBalance" class="method-link">UserWalletBalance</a></li></ul></li><li id="ProfileMethods-nav">
          <div data-name="ProfileMethods" class="class-link-container"><a class="class-link">ProfileMethods</a></div><ul class='methods'><li data-type="method" id="ProfileMethods-ProfileMethods-nav"><a href="module-ProfileMethods.html" class="method-link">ProfileMethods</a></li><h4 class="methodGroupHeader">Profile</h4><li data-type="method" id="ProfileMethods-Profile-nav"><a href="module-ProfileMethods.html#.Profile" class="method-link">Profile</a></li><h4 class="methodGroupHeader">ProfileMetadata</h4><li data-type="method" id="ProfileMethods-ProfileMetadata-nav"><a href="module-ProfileMethods.html#.ProfileMetadata" class="method-link">ProfileMetadata</a></li><li data-type="method" id="ProfileMethods-RemoveProfileMetadata-nav"><a href="module-ProfileMethods.html#.RemoveProfileMetadata" class="method-link">RemoveProfileMetadata</a></li><li data-type="method" id="ProfileMethods-SetProfileMetadata-nav"><a href="module-ProfileMethods.html#.SetProfileMetadata" class="method-link">SetProfileMetadata</a></li></ul></li></ul>
      </div>
    </nav>

    <div class="main">
      <div class="header"></div>
      <div class="main-content">
        
        <h1 class="page-title">
          Profile.js
        </h1>
        

        
      

<a class="button" href="Profile.html">Back</a>
<div class="source-container">
  <pre class="prettyprint source linenums"><code>const Utils = require("../Utils");
const UrlJoin = require("url-join");

const StateStorePath = ({network, path}) => {
  return UrlJoin(network === "main" ? "/main" : "/dv3", path);
};

const UserProfilePath = ({network, appId, userAddress, key, type, mode}) => {
  return StateStorePath({network, path: UrlJoin(type === "app" ? "app" : "usr", type === "app" ? appId : "", userAddress, mode === "public" ? "pub" : "pri", key || "")});
};

/**
 * Methods related to getting and setting user profile data.
 *
 * @module ProfileMethods
 */

/**
 * Retrieve user profile metadata for the specified user
 *
 * @methodGroup ProfileMetadata
 * @namedParams
 * @param {string=} type="app" - Specify `app` or `user` metadata.
 * @param {string=} mode="public" - Specify `public` or `private` metadata. If private is specified, you may only retrieve metadata for the current user.
 * @param {string=} appId - Namespace to use for the metadata, if retrieving app metadata. Uses the app ID specified on client initialization by default.
 * @param {string=} userAddress - User to retrieve metadata for. If not specified, will retrieve metadata for the current user
 * @param {string=} key - The metadata key to retrieve
 *
 * @returns {Promise&lt;Object|String>} - Returns the specified metadata
 */
exports.ProfileMetadata = async function({type="app", mode="public", appId, userAddress, key}) {
  try {
    const response = await this.stateStoreClient.Request({
      path: UserProfilePath({
        network: this.network,
        appId: appId || this.appId,
        userAddress: userAddress || this.UserAddress(),
        type,
        mode,
        key
      }),
      headers: mode === "private" ?
        {Authorization: `Bearer ${this.AuthToken()}`} : undefined
    });

    if(!response.ok) {
      throw response;
    }

    return (await Utils.ResponseToJson(response))[key];
  } catch(error) {
    if(error.status === 404) {
      return undefined;
    }

    throw error;
  }
};

/**
 * Set user profile metadata for the current user
 *
 * @methodGroup ProfileMetadata
 * @namedParams
 * @param {string=} type="app" - Specify `app` or `user` metadata.
 * @param {string=} mode="public" - Specify `public` or `private` metadata.
 * @param {string=} appId - Namespace to use for the metadata, if retrieving app metadata. Uses the app ID specified on client initialization by default.
 * @param {string} key - The metadata key to set
 * @param {string} value - The metadata value to set
 */
exports.SetProfileMetadata = async function({type="app", mode="public", appId, key, value}) {
  await this.stateStoreClient.Request({
    method: "POST",
    path: UserProfilePath({
      network: this.network,
      appId: appId || this.appId,
      userAddress: this.UserAddress(),
      type,
      mode,
      key
    }),
    body: value,
    bodyType: typeof value === "object" ? "JSON" : "string",
    headers: {
      Authorization: `Bearer ${this.AuthToken()}`
    }
  });
};


/**
 * Remove user profile metadata for the current user
 *
 * @methodGroup ProfileMetadata
 * @namedParams
 * @param {string=} type="app" - Specify `app` or `user` metadata.
 * @param {string=} mode="public" - Specify `public` or `private` metadata.
 * @param {string=} appId - Namespace to use for the metadata, if retrieving app metadata.. Uses the app ID specified on client initialization by default.
 * @param {string} key - The metadata key to set
 */
exports.RemoveProfileMetadata = async function({type="app", mode="public", appId, key}) {
  await this.stateStoreClient.Request({
    method: "DELETE",
    path: UserProfilePath({
      network: this.network,
      appId: appId || this.appId,
      userAddress: this.UserAddress(),
      type,
      mode,
      key
    }),
    headers: {
      Authorization: `Bearer ${this.AuthToken()}`
    }
  });
};

/**
 * Retrieve profile info for the specified user, including address, username and profile image (if set)
 *
 * @methodGroup Profile
 * @param {string=} userAddress - Address of the user
 * @param {string=} userName - Username of the user
 *
 * @returns {Promise&lt;Object>} - Profile info of the specified user
 */
exports.Profile = async function({userAddress, userName}) {
  if(userName) {
    userAddress = await this.UserNameToAddress({userName});
  }

  if(!userAddress) {
    throw Error("Eluvio Wallet Client: Unable to determine profile - user address not specified");
  }

  if(!userName) {
    userName = await this.ProfileMetadata({type: "user", userAddress, key: "username"});
  }

  const imageUrl = await this.ProfileMetadata({type: "user", userAddress, key: "icon_url"});

  return {
    userAddress: Utils.FormatAddress(userAddress),
    userName,
    imageUrl
  };
};

exports.UserNameToAddress = async function({userName}) {
  try {
    const response = await this.stateStoreClient.Request({
      method: "GET",
      path: StateStorePath({network: this.network, path: UrlJoin("usr", "profile_for_username", userName)}),
    });

    if(!response.ok) {
      throw response;
    }

    return (await Utils.ResponseToJson(response)).address;
  } catch(error) {
    if(error.status !== 404) {
      throw error;
    }
  }

  return undefined;
};












</code></pre>
</div>

    



        <footer class="footer">
          Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a>
        </footer>
      </div>
    </div>
  </div>

  <script>
    // Format and add line numbers to code
    prettyPrint();
  </script>

  <script type="text/javascript" src="scripts/utils.js"></script>

  </body>
</html>
